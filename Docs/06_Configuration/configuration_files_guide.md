# ModESP Configuration Files Guide

## üìã –û–≥–ª—è–¥

ModESP –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î JSON-—Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–æ–≥–æ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è. –í—Å—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤–±—É–¥–æ–≤—É—é—Ç—å—Å—è –≤ –ø—Ä–æ—à–∏–≤–∫—É –ø—ñ–¥ —á–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó.

## üóÇÔ∏è –î–æ—Å—Ç—É–ø–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

### default_config.json - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫
- **–î—ñ–∞–ø–∞–∑–æ–Ω —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä**: -10¬∞C –¥–æ +10¬∞C  
- **–¢–∏–ø –∫–µ—Ä—É–≤–∞–Ω–Ω—è**: –û–¥–Ω–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∏–π
- **–¶–∏–∫–ª —Ä–æ–∑–º–æ—Ä–æ–∂—É–≤–∞–Ω–Ω—è**: –ë–∞–∑–æ–≤–∏–π

### freezer_config.json - –ö–æ–º–µ—Ä—Ü—ñ–π–Ω–∞ –º–æ—Ä–æ–∑–∏–ª—å–Ω–∞ –∫–∞–º–µ—Ä–∞
- **–î—ñ–∞–ø–∞–∑–æ–Ω —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä**: -30¬∞C –¥–æ -10¬∞C
- **–¶–∏–∫–ª–∏ —Ä–æ–∑–º–æ—Ä–æ–∂—É–≤–∞–Ω–Ω—è**: –ü—Ä–æ–¥–æ–≤–∂–µ–Ω—ñ
- **–ö–æ–º–ø—Ä–µ—Å–æ—Ä**: –ó–Ω–∏–∂–µ–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –≤–∫–ª—é—á–µ–Ω—å

### ripening_config.json - –ö–∞–º–µ—Ä–∞ –¥–æ–∑—Ä—ñ–≤–∞–Ω–Ω—è
- **–î—ñ–∞–ø–∞–∑–æ–Ω —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä**: +10¬∞C –¥–æ +20¬∞C
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–æ–ª–æ–≥–æ—Å—Ç—ñ**: 85% ¬± 3%
- **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ CO2**: –í–∫–ª—é—á–µ–Ω–∏–π
- **–ö—Ä–∏–≤—ñ –¥–æ–∑—Ä—ñ–≤–∞–Ω–Ω—è**: –ü–æ–ø–µ—Ä–µ–¥–Ω—å–æ –∑–∞–ø—Ä–æ–≥—Ä–∞–º–æ–≤–∞–Ω—ñ

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

```json
{
    "version": 1,                    // –í–µ—Ä—Å—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó
    "system": {                      // –°–∏—Å—Ç–µ–º–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
        "name": "–ù–∞–∑–≤–∞ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è",
        "type": "—Ç–∏–ø_–æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è"
    },
    "climate": {                     // –ö–æ–Ω—Ç—Ä–æ–ª—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏
        "setpoint": 4.0,             // –£—Å—Ç–∞–≤–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏
        "hysteresis": 0.5            // –ì—ñ—Å—Ç–µ—Ä–µ–∑–∏—Å
    },
    "compressor": {                  // –ó–∞—Ö–∏—Å—Ç –∫–æ–º–ø—Ä–µ—Å–æ—Ä–∞
        "min_off_time": 180,         // –ú—ñ–Ω. —á–∞—Å –≤–∏–º–∫–Ω–µ–Ω–Ω—è (—Å–µ–∫)
        "min_on_time": 120           // –ú—ñ–Ω. —á–∞—Å —Ä–æ–±–æ—Ç–∏ (—Å–µ–∫)
    },
    "sensors": {                     // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–∞—Ç—á–∏–∫—ñ–≤
        "temperature": {
            "type": "DS18B20",
            "pin": 4,
            "resolution": 12
        }
    },
    "actuators": {                   // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∞–∫—Ç—É–∞—Ç–æ—Ä—ñ–≤
        "compressor": {
            "pin": 2,
            "active_level": "HIGH"
        }
    }
}
```

## üíª –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–¥—ñ

```cpp
// –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –º–æ—Ä–æ–∑–∏–ª—å–Ω–∏–∫–∞
ConfigManager::load_type("freezer");

// –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π —Ç–∏–ø
std::string type = ConfigManager::get_type();

// –°–∫–∏–Ω—É—Ç–∏ –¥–æ –∑–∞–≤–æ–¥—Å—å–∫–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
ConfigManager::reset_to_defaults();

// –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
float setpoint = ConfigManager::get<float>("climate.setpoint");
```

## ‚úÖ –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤–ª–∞—Å–Ω–∏—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π

### 1. –°—Ç–≤–æ—Ä—ñ—Ç—å JSON —Ñ–∞–π–ª
```bash
# –£ –ø–∞–ø—Ü—ñ components/core/configs/
touch my_equipment_config.json
```

### 2. –°–ª—ñ–¥—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π
```json
{
    "version": 1,
    "system": {
        "name": "My Equipment",
        "type": "my_equipment"
    },
    // ... —ñ–Ω—à—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
}
```

### 3. –î–æ–¥–∞–π—Ç–µ —Ñ–∞–π–ª –¥–æ CMakeLists.txt
```cmake
# –£ components/core/CMakeLists.txt
set(CONFIG_FILES
    "configs/default_config.json"
    "configs/freezer_config.json"
    "configs/ripening_config.json"
    "configs/my_equipment_config.json"  # –î–æ–¥–∞–π—Ç–µ —Å–≤—ñ–π —Ñ–∞–π–ª
)
```

### 4. –ü–µ—Ä–µ–∑–±–µ—Ä—ñ—Ç—å –ø—Ä–æ–µ–∫—Ç
```bash
idf.py build
```

## üîß Best Practices

### 1. **–í–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π**
```json
{
    "version": 2,  // –ó–±—ñ–ª—å—à—É–π—Ç–µ –ø—Ä–∏ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–∞—Ö
    // ...
}
```

### 2. **–î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω**
```json
{
    // –ö–æ–º–ø—Ä–µ—Å–æ—Ä: –∑–±—ñ–ª—å—à–µ–Ω–æ –º—ñ–Ω. —á–∞—Å –¥–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è –∑–Ω–æ—Å—É
    "min_off_time": 240  // –±—É–ª–æ 180
}
```

### 3. **–ë–µ–∑–ø–µ—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**
```json
{
    "climate": {
        "setpoint": 4.0,      // –ë–µ–∑–ø–µ—á–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
        "max_setpoint": 15.0, // –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø–µ—Ä–µ–≥—Ä—ñ–≤–∞–Ω–Ω—è
        "min_setpoint": -25.0 // –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø–µ—Ä–µ–æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è
    }
}
```

### 4. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ–≤**
```json
{
    "sensors": {
        "temperature": {
            "min_value": -50.0,  // –¢–µ—Ö–Ω—ñ—á–Ω—ñ –º–µ–∂—ñ –¥–∞—Ç—á–∏–∫–∞
            "max_value": 85.0,
            "error_threshold": 3.0  // –ü–æ—Ä—ñ–≥ –ø–æ–º–∏–ª–∫–∏
        }
    }
}
```

## üõ°Ô∏è –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π

### –†—ñ–≤–Ω—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:
1. **–ß–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó**: –°–∏–Ω—Ç–∞–∫—Å–∏—Å JSON
2. **–ß–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**: –û–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è
3. **–ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**: –î—ñ–∞–ø–∞–∑–æ–Ω–∏ –∑–Ω–∞—á–µ–Ω—å

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:
```cpp
// –£ config_manager.cpp
bool ConfigManager::validate_climate_config(const json& config) {
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–±–æ–≤'—è–∑–∫–æ–≤–∏—Ö –ø–æ–ª—ñ–≤
    if (!config.contains("setpoint")) {
        ESP_LOGE(TAG, "Missing 'setpoint' in climate config");
        return false;
    }
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ–≤
    float setpoint = config["setpoint"];
    if (setpoint < -50.0 || setpoint > 50.0) {
        ESP_LOGE(TAG, "Setpoint %f out of range", setpoint);
        return false;
    }
    
    return true;
}
```

## üîÑ –ú—ñ–≥—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π

### –ü—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏:

1. **–ó–±—ñ–ª—å—à—ñ—Ç—å –Ω–æ–º–µ—Ä –≤–µ—Ä—Å—ñ—ó**
```json
{
    "version": 2,  // –±—É–ª–æ 1
    // ...
}
```

2. **–î–æ–¥–∞–π—Ç–µ –ª–æ–≥—ñ–∫—É –º—ñ–≥—Ä–∞—Ü—ñ—ó**
```cpp
void ConfigManager::migrate_config(json& config) {
    int version = config.value("version", 1);
    
    if (version == 1) {
        // –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑ –≤–µ—Ä—Å—ñ—ó 1 –¥–æ 2
        if (config.contains("old_field")) {
            config["new_field"] = config["old_field"];
            config.erase("old_field");
        }
        config["version"] = 2;
    }
}
```

3. **–î–æ–∫—É–º–µ–Ω—Ç—É–π—Ç–µ –∑–º—ñ–Ω–∏**
```markdown
## Changelog
- v2: –ü–µ—Ä–µ–π–º–µ–Ω–æ–≤–∞–Ω–æ 'old_field' ‚Üí 'new_field'
- v1: –ü–æ—á–∞—Ç–∫–æ–≤–∞ –≤–µ—Ä—Å—ñ—è
```

## üìç –†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

```
components/core/configs/
‚îú‚îÄ‚îÄ default_config.json      # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫
‚îú‚îÄ‚îÄ freezer_config.json      # –ú–æ—Ä–æ–∑–∏–ª—å–Ω–∞ –∫–∞–º–µ—Ä–∞
‚îú‚îÄ‚îÄ ripening_config.json     # –ö–∞–º–µ—Ä–∞ –¥–æ–∑—Ä—ñ–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ my_equipment_config.json # –í–∞—à–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îî‚îÄ‚îÄ README.md               # –¶—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
```

## üîó –ü–æ–≤'—è–∑–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- [ConfigManager API](../03_Components/core/config_manager.md)
- [–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏](../02_Architecture/system_architecture.md)
- [–ö–µ—Ä—É–≤–∞–Ω–Ω—è –º–æ–¥—É–ª—è–º–∏](../03_Components/core/module_manager.md)

---

*–û–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è Phase 5 Architecture*
