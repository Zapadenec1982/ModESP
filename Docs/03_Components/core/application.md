# Application - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É ModuChill

## –û–≥–ª—è–¥ —ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

Application —î —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É —Å–∏—Å—Ç–µ–º–∏ ModuChill –¥–ª—è –ø—Ä–æ–º–∏—Å–ª–æ–≤–∏—Ö —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫. –ó–∞–±–µ–∑–ø–µ—á—É—î –¥–µ—Ç–µ—Ä–º—ñ–Ω—ñ—Å—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫, —Å—Ç–∞–±—ñ–ª—å–Ω—É —Ä–æ–±–æ—Ç—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ —Ç–∞ –≥—Ä–∞—Ü–∏–æ–∑–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ –∑ –ø–æ–≤–Ω–æ—é –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –±–∞–≥–∞—Ç–æ—è–¥–µ—Ä–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ ESP32-S3.

## –ö–ª—é—á–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

* **–ë–∞–≥–∞—Ç–æ—è–¥–µ—Ä–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞**: –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –¥–ª—è ESP32-S3 –∑ —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º—ñ–∂ —è–¥—Ä–∞–º–∏
* **Lifecycle Management**: –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω–∞–º–∏ BOOT ‚Üí INIT ‚Üí RUNNING ‚Üí ERROR/SHUTDOWN
* **–§—ñ–∫—Å–æ–≤–∞–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**: 100Hz –≥–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –¥–ª—è –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ–≥–æ —Ç–∞–π–º—ñ–Ω–≥—É
* **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å—ñ–≤**: –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è heap, CPU, stack usage –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
* **Error handling**: –ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø–æ–º–∏–ª–æ–∫, —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è, degraded operation
* **Health monitoring**: –°–∏—Å—Ç–µ–º–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–∞ reporting
* **–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–µ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
* **Performance tracking**: –î–µ—Ç–∞–ª—å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏

* **–î–µ—Ç–µ—Ä–º—ñ–Ω—ñ—Å—Ç–∏—á–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è**: –§—ñ–∫—Å–æ–≤–∞–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
* **–§—ñ–∫—Å–æ–≤–∞–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**: 100Hz –≥–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –¥–ª—è –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ–≥–æ —Ç–∞–π–º—ñ–Ω–≥—É
* **Multicore optimization**: Core 0 –¥–ª—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏, Core 1 –¥–ª—è –¥–∞—Ç—á–∏–∫—ñ–≤
* **Graceful degradation**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–≤–∂—É—î —Ä–æ–±–æ—Ç—É –±–µ–∑ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
* **Resource bounded**: –í—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –º–∞—é—Ç—å –æ–±–º–µ–∂–µ–Ω–Ω—è –∑–∞ —á–∞—Å–æ–º/–ø–∞–º'—è—Ç—Ç—é
* **–ü—Ä–æ–º–∏—Å–ª–æ–≤–∞ –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å**: –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ—è—Ö

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç–∏—á–Ω–∞ –ø–∞–º'—è—Ç—å |
|-----------|-------------------|
| Application state | 128-256B |
| Main task stack | 12KB (–∑–±—ñ–ª—å—à–µ–Ω–æ –¥–ª—è JSON parsing) |
| Sensor task stack | 4KB |
| Performance metrics | ~100B |
| **–ó–∞–≥–∞–ª–æ–º** | **~16KB RAM** |

## –ë–∞–≥–∞—Ç–æ—è–¥–µ—Ä–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
ESP32-S3 Dual Core Architecture

Core 0 (Protocol CPU)                    Core 1 (Application CPU)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     Main Application    ‚îÇ             ‚îÇ     Sensor Task         ‚îÇ
‚îÇ                         ‚îÇ             ‚îÇ                         ‚îÇ
‚îÇ  ‚Ä¢ Business Logic       ‚îÇ             ‚îÇ  ‚Ä¢ SensorModule         ‚îÇ
‚îÇ  ‚Ä¢ Climate Control      ‚îÇ             ‚îÇ  ‚Ä¢ Data Collection      ‚îÇ
‚îÇ  ‚Ä¢ Actuator Control     ‚îÇ             ‚îÇ  ‚Ä¢ 10Hz Updates         ‚îÇ
‚îÇ  ‚Ä¢ Event Processing     ‚îÇ             ‚îÇ  ‚Ä¢ Real-time Reading    ‚îÇ
‚îÇ  ‚Ä¢ UI/Network          ‚îÇ             ‚îÇ                         ‚îÇ
‚îÇ  ‚Ä¢ 100Hz Main Loop     ‚îÇ             ‚îÇ                         ‚îÇ
‚îÇ                         ‚îÇ             ‚îÇ                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ             ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Module Updates    ‚îÇ‚îÇ             ‚îÇ ‚îÇ  Sensor Drivers     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   (8ms budget)      ‚îÇ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ  DS18B20, NTC, etc. ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ             ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                         ‚îÇ             ‚îÇ                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ             ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Event Processing   ‚îÇ‚îÇ             ‚îÇ ‚îÇ   Shared State      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   (2ms budget)      ‚îÇ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ   Publishing        ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ             ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ                                       ‚îÇ
             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ    Shared State     ‚îÇ
                    ‚îÇ   Event Bus        ‚îÇ
                    ‚îÇ   (Sync Primitives) ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –†–æ–∑–ø–æ–¥—ñ–ª –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

**Core 0 (Main Task):**
- –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –º–æ–¥—É–ª—ñ–≤ (Climate Control, Defrost Control)
- Actuator —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
- Event Bus processing
- UI/Network communication
- Health monitoring
- Configuration management

**Core 1 (Sensor Task):**
- Sensor data collection
- Real-time sensor readings
- Data validation —Ç–∞ filtering
- SharedState publishing


## State Machine & Lifecycle

### –°–∏—Å—Ç–µ–º–Ω—ñ —Å—Ç–∞–Ω–∏

```cpp
enum class State {
    BOOT,       // Hardware initialization (0-10ms)
    INIT,       // Service initialization (10-500ms)
    RUNNING,    // Normal operation
    ERROR,      // Recovery mode
    SHUTDOWN    // Graceful shutdown
};
```

**BOOT (0-10ms)**
```
‚îú‚îÄ‚îÄ Hardware initialization (NVS, GPIO, UART)
‚îú‚îÄ‚îÄ System clock configuration
‚îú‚îÄ‚îÄ Watchdog setup
‚îú‚îÄ‚îÄ MAC address reading
‚îî‚îÄ‚îÄ Boot diagnostics
```

**INIT (10-500ms)**
```
‚îú‚îÄ‚îÄ Core services initialization
‚îÇ   ‚îú‚îÄ‚îÄ EventBus::init()
‚îÇ   ‚îú‚îÄ‚îÄ SharedState::init()
‚îÇ   ‚îú‚îÄ‚îÄ ConfigManager::init()
‚îÇ   ‚îî‚îÄ‚îÄ ModuleManager::init()
‚îú‚îÄ‚îÄ HAL layer initialization (ESPhal::init())
‚îú‚îÄ‚îÄ Built-in sensor drivers initialization
‚îú‚îÄ‚îÄ Module registration (ModuleRegistry::register_all_modules())
‚îú‚îÄ‚îÄ Initial configuration loading (stack-safe)
‚îú‚îÄ‚îÄ Module configuration and initialization
‚îú‚îÄ‚îÄ Full configuration loading from storage
‚îú‚îÄ‚îÄ Functional tests execution
‚îî‚îÄ‚îÄ System startup event publishing
```

**RUNNING (Normal operation)**
```
Main Loop @ 100Hz (Core 0):
‚îú‚îÄ‚îÄ Module updates (8ms budget) - except sensors
‚îú‚îÄ‚îÄ Event processing (2ms budget)
‚îú‚îÄ‚îÄ Health monitoring (1Hz)
‚îú‚îÄ‚îÄ Performance metrics collection
‚îú‚îÄ‚îÄ CPU usage calculation
‚îî‚îÄ‚îÄ Watchdog feeding

Sensor Task @ 10Hz (Core 1):
‚îú‚îÄ‚îÄ Sensor data collection via SensorModule
‚îú‚îÄ‚îÄ SharedState publishing
‚îú‚îÄ‚îÄ Performance monitoring
‚îî‚îÄ‚îÄ Error reporting
```

**ERROR (Recovery mode)**
```
‚îú‚îÄ‚îÄ Error classification (WARNING/ERROR/CRITICAL/FATAL)
‚îú‚îÄ‚îÄ Recovery attempts based on severity
‚îú‚îÄ‚îÄ Component disabling for non-critical errors
‚îú‚îÄ‚îÄ Degraded operation mode
‚îú‚îÄ‚îÄ Error reporting via EventBus
‚îú‚îÄ‚îÄ Automatic restart for CRITICAL/FATAL errors
‚îî‚îÄ‚îÄ Error count tracking
```

**SHUTDOWN (Graceful stop)**
```
‚îú‚îÄ‚îÄ Stop accepting new operations
‚îú‚îÄ‚îÄ Terminate sensor task (Core 1)
‚îú‚îÄ‚îÄ Complete pending work
‚îú‚îÄ‚îÄ Save persistent state via ConfigManager::save()
‚îú‚îÄ‚îÄ Module shutdown (reverse priority order)
‚îú‚îÄ‚îÄ Resource cleanup
‚îî‚îÄ‚îÄ System halt or restart
```

### –ü–µ—Ä–µ—Ö–æ–¥–∏ —Å—Ç–∞–Ω—ñ–≤

* **BOOT ‚Üí INIT**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ—Å–ª—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ hardware
* **INIT ‚Üí RUNNING**: –í—Å—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ + —Ç–µ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω—ñ
* **RUNNING ‚Üí ERROR**: –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
* **ERROR ‚Üí RUNNING**: –£—Å–ø—ñ—à–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
* **ANY ‚Üí SHUTDOWN**: –ó–∞–ø–∏—Ç –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏
* **ERROR ‚Üí BOOT**: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—ñ—Å–ª—è —Ñ–∞—Ç–∞–ª—å–Ω–æ—ó –ø–æ–º–∏–ª–∫–∏ (—á–µ—Ä–µ–∑ esp_restart())

## –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è (–ö—Ä–∏—Ç–∏—á–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫)

```
–ü–æ—Ä—è–¥–æ–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó (–ù–ï–î–û–¢–†–ò–ú–ê–ù–ù–Ø = UNDEFINED BEHAVIOR):

1. Hardware Layer
   ‚îú‚îÄ‚îÄ NVS Flash initialization
   ‚îú‚îÄ‚îÄ GPIO, UART setup
   ‚îî‚îÄ‚îÄ System clocks

2. Core Services (–±–µ–∑ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π)
   ‚îú‚îÄ‚îÄ EventBus::init()
   ‚îú‚îÄ‚îÄ SharedState::init()
   ‚îú‚îÄ‚îÄ ConfigManager::init()
   ‚îî‚îÄ‚îÄ ModuleManager::init()

3. Hardware Abstraction
   ‚îî‚îÄ‚îÄ ESPhal::init() (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ Config)

4. Driver Registration
   ‚îú‚îÄ‚îÄ initialize_builtin_sensor_drivers()
   ‚îî‚îÄ‚îÄ ModuleRegistry::register_all_modules()

5. Configuration Management
   ‚îú‚îÄ‚îÄ ConfigManager::load_initial_config() (stack-safe)
   ‚îú‚îÄ‚îÄ ModuleManager::configure_all()
   ‚îî‚îÄ‚îÄ ConfigManager::load() (–ø–æ–≤–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è)

6. Module Initialization
   ‚îî‚îÄ‚îÄ ModuleManager::init_all() (–∑–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∞–º–∏)

7. System Validation
   ‚îú‚îÄ‚îÄ CoreTests::run_all_tests()
   ‚îî‚îÄ‚îÄ EventBus::publish("system.started")
```

## API Reference

### Lifecycle Control

```cpp
/**
 * @brief –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ–¥–∞—Ç–∫—É
 * 
 * –í–∏–∫–æ–Ω—É—î –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –≤—Å—ñ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —Å–∏—Å—Ç–µ–º–∏
 * —É –≤–∏–∑–Ω–∞—á–µ–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É. –í–∫–ª—é—á–∞—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —Ç–µ—Å—Ç–∏.
 * 
 * @return ESP_OK –ø—Ä–∏ —É—Å–ø—ñ—Ö—É, –∫–æ–¥ –ø–æ–º–∏–ª–∫–∏ —ñ–Ω–∞–∫—à–µ
 */
esp_err_t init();

/**
 * @brief –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É –¥–æ–¥–∞—Ç–∫—É
 * 
 * –ó–∞–ø—É—Å–∫–∞—î –≥–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –Ω–∞ 100Hz —Ç–∞ sensor task –Ω–∞ Core 1.
 * –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –±–ª–æ–∫—É—î—Ç—å—Å—è –Ω–∞–∑–∞–≤–∂–¥–∏.
 * 
 * –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ–ª–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É:
 * - –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤ (8ms budget)
 * - –û–±—Ä–æ–±–∫–∞ –ø–æ–¥—ñ–π (2ms budget)
 * - Health monitoring (1Hz)
 * - Watchdog feeding
 */
[[noreturn]] void run();

/**
 * @brief –ó–∞–ø–∏—Ç –≥—Ä–∞—Ü–∏–æ–∑–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
 * 
 * –Ü–Ω—ñ—Ü—ñ—é—î –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è:
 * 1. –ó—É–ø–∏–Ω–∫–∞ –Ω–æ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
 * 2. –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ—ó —Ä–æ–±–æ—Ç–∏
 * 3. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É
 * 4. –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤ —É –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
 * 5. –û—á–∏—â–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
 */
void shutdown();

/**
 * @brief –ó–∞–ø–∏—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É —Å–∏—Å—Ç–µ–º–∏
 * 
 * @param delay_ms –ó–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 1000ms)
 */
void restart(uint32_t delay_ms = 1000);
```

### State Management

```cpp
/**
 * @brief –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –¥–æ–¥–∞—Ç–∫—É
 * @return –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω
 */
State get_state();

/**
 * @brief –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –¥–æ–¥–∞—Ç–æ–∫ –ø—Ä–∞—Ü—é—î
 * @return true —è–∫—â–æ –≤ —Å—Ç–∞–Ω—ñ RUNNING
 */
bool is_running();
```

### Error Handling

```cpp
/**
 * @brief –†—ñ–≤–Ω—ñ —Å–µ—Ä–π–æ–∑–Ω–æ—Å—Ç—ñ –ø–æ–º–∏–ª–æ–∫
 */
enum class ErrorSeverity {
    WARNING,    // –ù–µ–∫—Ä–∏—Ç–∏—á–Ω–∞, —Ç—ñ–ª—å–∫–∏ –ª–æ–≥—É—î—Ç—å—Å—è
    ERROR,      // –ú–æ–∂–ª–∏–≤–∞ –¥–µ–≥—Ä–∞–¥–æ–≤–∞–Ω–∞ —Ä–æ–±–æ—Ç–∞
    CRITICAL,   // –ü–æ—Ç—Ä—ñ–±–µ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º–∏
    FATAL       // –ù–µ–≥–∞–π–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
};

/**
 * @brief –ó–≤—ñ—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É –≤—ñ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * 
 * @param component –Ü–º'—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "climate_control")
 * @param error –ö–æ–¥ –ø–æ–º–∏–ª–∫–∏ ESP-IDF
 * @param severity –†—ñ–≤–µ–Ω—å —Å–µ—Ä–π–æ–∑–Ω–æ—Å—Ç—ñ –ø–æ–º–∏–ª–∫–∏
 * @param message –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É
 */
void report_error(const char* component, esp_err_t error, 
                 ErrorSeverity severity, const char* message = nullptr);
```

### Health Monitoring

```cpp
/**
 * @brief –í–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤'—è
 * 
 * –ü–µ—Ä–µ–≤—ñ—Ä—è—î:
 * - –í—ñ–ª—å–Ω—É –ø–∞–º'—è—Ç—å heap
 * - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ç–µ–∫—É
 * - Health scores –º–æ–¥—É–ª—ñ–≤
 * - –ö—Ä–∏—Ç–∏—á–Ω—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏
 * 
 * @return true —è–∫—â–æ —Å–∏—Å—Ç–µ–º–∞ –∑–¥–æ—Ä–æ–≤–∞
 */
bool check_health();
```

### System Metrics

```cpp
/**
 * @brief –û—Ç—Ä–∏–º–∞–Ω–Ω—è —á–∞—Å—É —Ä–æ–±–æ—Ç–∏ —Å–∏—Å—Ç–µ–º–∏ –≤ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞—Ö
 * @return –ú—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∏ –∑ –º–æ–º–µ–Ω—Ç—É –∑–∞–≥—Ä—É–∑–∫–∏
 */
uint32_t get_uptime_ms();

/**
 * @brief –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–ª—å–Ω–æ—ó –ø–∞–º'—è—Ç—ñ heap
 * @return –í—ñ–ª—å–Ω–∞ –ø–∞–º'—è—Ç—å —É –±–∞–π—Ç–∞—Ö
 */
size_t get_free_heap();

/**
 * @brief –û—Ç—Ä–∏–º–∞–Ω–Ω—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—ó –≤—ñ–ª—å–Ω–æ—ó –ø–∞–º'—è—Ç—ñ –∑ –º–æ–º–µ–Ω—Ç—É –∑–∞–≥—Ä—É–∑–∫–∏
 * @return –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≤—ñ–ª—å–Ω–∞ –ø–∞–º'—è—Ç—å —É –±–∞–π—Ç–∞—Ö
 */
size_t get_min_free_heap();

/**
 * @brief –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è CPU —É –≤—ñ–¥—Å–æ—Ç–∫–∞—Ö
 * @return –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è CPU 0-100%
 */
uint8_t get_cpu_usage();

/**
 * @brief –û—Ç—Ä–∏–º–∞–Ω–Ω—è high water mark —Å—Ç–µ–∫—É –≥–æ–ª–æ–≤–Ω–æ—ó –∑–∞–¥–∞—á—ñ
 * @return –ó–∞–ª–∏—à–∏–ª–æ—Å—è –±–∞–π—Ç —Å—Ç–µ–∫—É
 */
size_t get_stack_high_water_mark();

/**
 * @brief –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Å—Ç–∞–Ω—Å—É ESPhal
 * @return –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ñ–Ω—Å—Ç–∞–Ω—Å ESPhal
 */
ESPhal& get_hal();
```


## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ–ª–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ü–∏–∫–ª—É (10ms @ 100Hz)

```cpp
// –°–ø—Ä–æ—â–µ–Ω–∞ —Å—Ö–µ–º–∞ –≥–æ–ª–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É
while (current_state == State::RUNNING) {
    uint32_t cycle_start = esp_timer_get_time();
    
    // 1. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤ (8ms budget) - –∫—Ä—ñ–º —Å–µ–Ω—Å–æ—Ä—ñ–≤
    ModuleManager::tick_all_except_sensors(MODULE_UPDATE_BUDGET_MS);
    
    // 2. –û–±—Ä–æ–±–∫–∞ –ø–æ–¥—ñ–π (2ms budget)
    EventBus::process(EVENT_PROCESS_BUDGET_MS);
    
    // 3. Health check (1Hz)
    if (now_ms - last_health_check_ms >= HEALTH_CHECK_PERIOD_MS) {
        check_health();
        log_performance_metrics();
        last_health_check_ms = now_ms;
    }
    
    // 4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
    update_cycle_metrics(cycle_start);
    
    // 5. –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è —á–∞—Å—É
    uint32_t cycle_time = esp_timer_get_time() - cycle_start;
    if (cycle_time > MAIN_LOOP_PERIOD_MS * 1000) {
        ESP_LOGW(TAG, "Cycle overrun: %lu us", cycle_time);
    }
    
    // 6. –§—ñ–∫—Å–æ–≤–∞–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
    vTaskDelayUntil(&last_wake_time, pdMS_TO_TICKS(MAIN_LOOP_PERIOD_MS));
}
```

### –ß–∞—Å–æ–≤—ñ –±—é–¥–∂–µ—Ç–∏

| –û–ø–µ—Ä–∞—Ü—ñ—è | –ß–∞—Å | –ß–∞—Å—Ç–æ—Ç–∞ | –û–ø–∏—Å |
|----------|-----|---------|------|
| **Module Updates** | 8ms | 100Hz | –û–Ω–æ–≤–ª–µ–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –º–æ–¥—É–ª—ñ–≤ |
| **Event Processing** | 2ms | 100Hz | –û–±—Ä–æ–±–∫–∞ —á–µ—Ä–≥–∏ –ø–æ–¥—ñ–π |
| **Health Check** | ~1ms | 1Hz | –°–∏—Å—Ç–µ–º–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ |
| **Performance Logging** | ~0.5ms | 1Hz | –ó–±—ñ—Ä —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è –º–µ—Ç—Ä–∏–∫ |
| **Cycle Management** | ~0.5ms | 100Hz | –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ü–∏–∫–ª–æ–º —Ç–∞ —Ç–∞–π–º—ñ–Ω–≥–æ–º |
| **–†–ï–ó–ï–†–í** | -2ms | - | –ó–∞–ª–∏—à–∞—î—Ç—å—Å—è –¥–ª—è –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∏—Ö –∑–∞—Ç—Ä–∏–º–æ–∫ |

### Sensor Task (Core 1)

```cpp
// –°–ø—Ä–æ—â–µ–Ω–∞ —Å—Ö–µ–º–∞ sensor task
static void sensor_task(void* pvParameters) {
    TickType_t last_wake_time = xTaskGetTickCount();
    const TickType_t sensor_period = pdMS_TO_TICKS(100); // 10Hz
    
    while (current_state == State::RUNNING) {
        uint64_t start_time_us = esp_timer_get_time();
        
        // –ó–Ω–∞–π—Ç–∏ —Ç–∞ –æ–Ω–æ–≤–∏—Ç–∏ SensorModule –Ω–∞ Core 1
        BaseModule* sensor_module = ModuleManager::find_module("SensorModule");
        if (sensor_module) {
            sensor_module->update();
        }
        
        // –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ sensor task
        update_sensor_task_metrics(start_time_us);
        
        vTaskDelayUntil(&last_wake_time, sensor_period);
    }
    
    vTaskDelete(nullptr);
}
```

## –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–ª—è –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ–≥–æ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è

### –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞ –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º–∏

```cpp
// main.c - –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É —Å–∏—Å—Ç–µ–º–∏
void app_main(void) {
    ESP_LOGI("Main", "ModuChill Industrial System starting...");
    
    // –ó–∞–ø—É—Å–∫ C++ –¥–æ–¥–∞—Ç–∫—É —á–µ—Ä–µ–∑ wrapper
    launch_application();
}

// application_wrapper.cpp - C++ wrapper
extern "C" void launch_application() {
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ–¥–∞—Ç–∫—É
    esp_err_t ret = Application::init();
    if (ret != ESP_OK) {
        ESP_LOGE("App", "Failed to initialize: %s", esp_err_to_name(ret));
        return;
    }
    
    // –ó–∞–ø—É—Å–∫ –≥–æ–ª–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É (–±–ª–æ–∫—É—î—Ç—å—Å—è –Ω–∞–∑–∞–≤–∂–¥–∏)
    Application::run();
}
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É —Å–∏—Å—Ç–µ–º–∏

```cpp
// –ú–æ–¥—É–ª—å –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å—Ç–∞–Ω—É —Å–∏—Å—Ç–µ–º–∏
class SystemMonitor {
public:
    void init() {
        // –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ñ –ø–æ–¥—ñ—ó
        EventBus::subscribe("system.*", [this](const Event& e) {
            handle_system_event(e);
        });
        
        // –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ–º–∏–ª–∫–∏
        EventBus::subscribe("system.error", [this](const Event& e) {
            handle_error_event(e);
        });
    }
    
    void update() {
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
        check_critical_parameters();
        
        // –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è —Å—Ç–∞—Ç—É—Å—É —Å–∏—Å—Ç–µ–º–∏
        publish_system_status();
    }
    
private:
    void check_critical_parameters() {
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–∞–º'—è—Ç—ñ
        size_t free_heap = Application::get_free_heap();
        if (free_heap < 10240) { // < 10KB
            Application::report_error("SystemMonitor", ESP_ERR_NO_MEM, 
                                    Application::ErrorSeverity::ERROR,
                                    "Low heap memory");
        }
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ CPU
        uint8_t cpu_usage = Application::get_cpu_usage();
        if (cpu_usage > 95) {
            Application::report_error("SystemMonitor", ESP_ERR_TIMEOUT,
                                    Application::ErrorSeverity::CRITICAL,
                                    "High CPU usage");
        }
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–µ–∫—É
        size_t stack_remaining = Application::get_stack_high_water_mark();
        if (stack_remaining < 1024) { // < 1KB
            Application::report_error("SystemMonitor", ESP_ERR_NO_MEM,
                                    Application::ErrorSeverity::CRITICAL,
                                    "Low stack space");
        }
    }
    
    void publish_system_status() {
        nlohmann::json status = {
            {"state", static_cast<int>(Application::get_state())},
            {"uptime_ms", Application::get_uptime_ms()},
            {"free_heap", Application::get_free_heap()},
            {"min_free_heap", Application::get_min_free_heap()},
            {"cpu_usage", Application::get_cpu_usage()},
            {"stack_remaining", Application::get_stack_high_water_mark()},
            {"is_healthy", Application::check_health()}
        };
        
        SharedState::set("system.status", status);
    }
    
    void handle_system_event(const Event& e) {
        if (e.type == "system.started") {
            ESP_LOGI(TAG, "System started successfully");
            auto data = e.data;
            ESP_LOGI(TAG, "Tests: %d/%d passed", 
                     data["tests_passed"].get<int>(),
                     data["tests_total"].get<int>());
        }
    }
    
    void handle_error_event(const Event& e) {
        auto data = e.data;
        std::string component = data["component"];
        int error_code = data["error_code"];
        int severity = data["severity"];
        std::string message = data["message"];
        
        ESP_LOGE(TAG, "System error from %s: 0x%x (severity: %d) - %s",
                 component.c_str(), error_code, severity, message.c_str());
        
        // –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –Ω–µ–≥–∞–π–Ω–æ—ó —É–≤–∞–≥–∏
        if (severity >= static_cast<int>(Application::ErrorSeverity::CRITICAL)) {
            // –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∞–≤–∞—Ä—ñ–π–Ω–∏–π —Å–∏–≥–Ω–∞–ª
            EventBus::publish("alarm.critical", {
                {"source", "SystemMonitor"},
                {"reason", "Critical system error"},
                {"component", component},
                {"error_code", error_code}
            }, EventBus::Priority::CRITICAL);
        }
    }
};
```

### Error Handling –¥–ª—è –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ–≥–æ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è

```cpp
// –ü—Ä–∏–∫–ª–∞–¥ error handling –≤ –º–æ–¥—É–ª—ñ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ–º–ø—Ä–µ—Å–æ—Ä–æ–º
class CompressorControl {
public:
    void update() {
        try {
            // –°–ø—Ä–æ–±–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ–º–ø—Ä–µ—Å–æ—Ä–æ–º
            control_compressor();
        } catch (const std::exception& e) {
            // –ü–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –≤–∏–∫–ª—é—á–µ–Ω—å
            Application::report_error("CompressorControl", ESP_FAIL,
                                    Application::ErrorSeverity::ERROR,
                                    e.what());
        }
    }
    
private:
    void control_compressor() {
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —É–º–æ–≤
        if (!check_safety_conditions()) {
            Application::report_error("CompressorControl", ESP_ERR_INVALID_STATE,
                                    Application::ErrorSeverity::WARNING,
                                    "Safety conditions not met");
            return;
        }
        
        // –°–ø—Ä–æ–±–∞ –≤–º–∏–∫–∞–Ω–Ω—è –∫–æ–º–ø—Ä–µ—Å–æ—Ä–∞
        esp_err_t err = turn_on_compressor();
        if (err != ESP_OK) {
            // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å–µ—Ä–π–æ–∑–Ω–æ—Å—Ç—ñ –ø–æ–º–∏–ª–∫–∏
            Application::ErrorSeverity severity;
            if (err == ESP_ERR_TIMEOUT) {
                severity = Application::ErrorSeverity::ERROR;
            } else if (err == ESP_ERR_NO_MEM) {
                severity = Application::ErrorSeverity::CRITICAL;
            } else {
                severity = Application::ErrorSeverity::WARNING;
            }
            
            Application::report_error("CompressorControl", err, severity,
                                    "Failed to turn on compressor");
        }
    }
    
    bool check_safety_conditions() {
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏
        auto temp = SharedState::get_typed<float>("sensor.chamber.temperature");
        if (temp && temp.value() > 10.0f) {
            return false; // –ó–∞–Ω–∞–¥—Ç–æ —Ç–µ–ø–ª–æ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∫–æ–º–ø—Ä–µ—Å–æ—Ä–∞
        }
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∏—Å–∫—É
        auto pressure = SharedState::get_typed<float>("sensor.pressure");
        if (pressure && pressure.value() > 25.0f) {
            return false; // –í–∏—Å–æ–∫–∏–π —Ç–∏—Å–∫
        }
        
        return true;
    }
    
    esp_err_t turn_on_compressor() {
        // –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è –∫–æ–º–ø—Ä–µ—Å–æ—Ä–∞
        // –ü–æ–≤–µ—Ä—Ç–∞—î ESP_OK –ø—Ä–∏ —É—Å–ø—ñ—Ö—É –∞–±–æ –∫–æ–¥ –ø–æ–º–∏–ª–∫–∏
        return ESP_OK;
    }
};
```

### Graceful Shutdown –¥–ª—è –ø—Ä–æ–º–∏—Å–ª–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º

```cpp
// –û–±—Ä–æ–±–∫–∞ —Å–∏–≥–Ω–∞–ª—ñ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏
class GracefulShutdownHandler {
public:
    void init() {
        // –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ñ –ø–æ–¥—ñ—ó –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
        EventBus::subscribe("system.shutdown_request", [this](const Event& e) {
            handle_shutdown_request(e);
        });
        
        // –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏
        EventBus::subscribe("alarm.critical", [this](const Event& e) {
            handle_critical_alarm(e);
        });
    }
    
private:
    void handle_shutdown_request(const Event& e) {
        ESP_LOGI(TAG, "Graceful shutdown requested");
        
        // –ó—É–ø–∏–Ω–∏—Ç–∏ –Ω–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
        stop_new_operations();
        
        // –ó–∞–≤–µ—Ä—à–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏
        complete_critical_processes();
        
        // –ó–±–µ—Ä–µ–≥—Ç–∏ –≤–∞–∂–ª–∏–≤—ñ –¥–∞–Ω—ñ
        save_operational_data();
        
        // –Ü–Ω—ñ—Ü—ñ—é–≤–∞—Ç–∏ shutdown
        Application::shutdown();
    }
    
    void handle_critical_alarm(const Event& e) {
        ESP_LOGE(TAG, "Critical alarm received, initiating emergency shutdown");
        
        // –ê–≤–∞—Ä—ñ–π–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
        emergency_shutdown();
        
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        Application::restart(5000);
    }
    
    void stop_new_operations() {
        // –í—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ø—Ä–∏–π–æ–º –Ω–æ–≤–∏—Ö –∫–æ–º–∞–Ω–¥
        SharedState::set("system.accepting_commands", false);
        
        // –ó—É–ø–∏–Ω–∏—Ç–∏ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –∑–∞–¥–∞—á
        SharedState::set("system.scheduler_enabled", false);
        
        ESP_LOGI(TAG, "New operations stopped");
    }
    
    void complete_critical_processes() {
        // –î–æ—á–µ–∫–∞—Ç–∏—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤
        // –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞–ø–∏—Å—É –¥–∞–Ω–∏—Ö, –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ü–∏–∫–ª—É —Ä–æ–∑–º–æ—Ä–æ–∂—É–≤–∞–Ω–Ω—è
        
        ESP_LOGI(TAG, "Waiting for critical processes to complete...");
        
        // –ú–∞–∫—Å–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
        int timeout_sec = 30;
        while (timeout_sec-- > 0) {
            if (all_critical_processes_complete()) {
                break;
            }
            vTaskDelay(pdMS_TO_TICKS(1000));
        }
        
        ESP_LOGI(TAG, "Critical processes completed or timed out");
    }
    
    void save_operational_data() {
        // –ó–±–µ—Ä–µ–≥—Ç–∏ –ø–æ—Ç–æ—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ –¥–∞–Ω—ñ
        nlohmann::json operational_data = {
            {"shutdown_time", esp_timer_get_time()},
            {"uptime_ms", Application::get_uptime_ms()},
            {"last_temperatures", get_last_temperatures()},
            {"compressor_hours", get_compressor_operating_hours()},
            {"error_count", get_total_error_count()}
        };
        
        SharedState::set("system.last_operational_data", operational_data);
        
        // –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
        ConfigManager::save();
        
        ESP_LOGI(TAG, "Operational data saved");
    }
    
    void emergency_shutdown() {
        // –ù–µ–≥–∞–π–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—Å—ñ—Ö –∞–∫—Ç—É–∞—Ç–æ—Ä—ñ–≤
        SharedState::set("command.actuator.compressor", false);
        SharedState::set("command.actuator.fan", false);
        SharedState::set("command.actuator.heater", false);
        
        // –ê–≤–∞—Ä—ñ–π–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö
        save_emergency_data();
        
        ESP_LOGE(TAG, "Emergency shutdown completed");
    }
    
    bool all_critical_processes_complete() {
        // –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –≤—Å—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ñ
        return true; // –°–ø—Ä–æ—â–µ–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è
    }
    
    nlohmann::json get_last_temperatures() {
        // –û—Ç—Ä–∏–º–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ –ø–æ–∫–∞–∑–∞–Ω–Ω—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏
        return nlohmann::json::array();
    }
    
    uint32_t get_compressor_operating_hours() {
        // –û—Ç—Ä–∏–º–∞—Ç–∏ –≥–æ–¥–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏ –∫–æ–º–ø—Ä–µ—Å–æ—Ä–∞
        return 0;
    }
    
    uint32_t get_total_error_count() {
        // –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫
        return 0;
    }
    
    void save_emergency_data() {
        // –ó–±–µ—Ä–µ–≥—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –ø—Ä–∏ –∞–≤–∞—Ä—ñ–π–Ω–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ñ
    }
};
```


## Performance Tuning —Ç–∞ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

Application –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–∏—Ä–∞—î –¥–µ—Ç–∞–ª—å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:

```cpp
// –ú–µ—Ç—Ä–∏–∫–∏ –≥–æ–ª–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É (Core 0)
struct MainLoopMetrics {
    uint32_t cycle_count;              // –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ü–∏–∫–ª—ñ–≤
    uint32_t min_cycle_time_us;        // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —á–∞—Å —Ü–∏–∫–ª—É
    uint32_t max_cycle_time_us;        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —á–∞—Å —Ü–∏–∫–ª—É
    uint32_t total_cycle_time_us;      // –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –≤—Å—ñ—Ö —Ü–∏–∫–ª—ñ–≤
    uint32_t overrun_count;            // –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–≤–∏—â–µ–Ω—å —á–∞—Å—É
};

// –ú–µ—Ç—Ä–∏–∫–∏ sensor task (Core 1)
struct SensorTaskMetrics {
    uint32_t sensor_cycle_count;       // –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ü–∏–∫–ª—ñ–≤ sensors
    uint64_t sensor_total_time_us;     // –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å sensor task
    uint32_t sensor_max_time_us;       // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —á–∞—Å sensor task
};

// –ü—Ä–∏–∫–ª–∞–¥ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –º–µ—Ç—Ä–∏–∫
void log_performance_metrics() {
    uint32_t avg_cycle_us = cycle_count > 0 ? 
        (uint32_t)(total_cycle_time_us / cycle_count) : 0;
    
    ESP_LOGI(TAG, "Performance: CPU: %u%%, Cycle: %lu/%lu/%lu Œºs (min/avg/max), Free heap: %zu KB",
             get_cpu_usage(),
             min_cycle_time_us,
             avg_cycle_us,
             max_cycle_time_us,
             get_free_heap() / 1024);
}
```

### Multicore Optimization Best Practices

**–†–æ–∑–ø–æ–¥—ñ–ª –º–æ–¥—É–ª—ñ–≤ –º—ñ–∂ —è–¥—Ä–∞–º–∏:**

```cpp
// Core 0 (Main Task) - –û–ø—Ç–∏–º–∞–ª—å–Ω—ñ –º–æ–¥—É–ª—ñ:
class CoreZeroModules {
    // ‚úÖ –ú–æ–¥—É–ª—ñ –∑ —á–∞—Å—Ç–∏–º–∏ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è–º–∏
    ClimateControlModule climate_control;    // –ß–∞—Å—Ç—ñ —Ä—ñ—à–µ–Ω–Ω—è —Ç–∞ –∫–æ–º–∞–Ω–¥–∏
    DefrostControlModule defrost_control;    // –õ–æ–≥—ñ–∫–∞ —Ä–æ–∑–º–æ—Ä–æ–∂—É–≤–∞–Ω–Ω—è
    UIModule ui_module;                      // –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    NetworkModule network_module;            // WiFi, HTTP, MQTT
    
    // ‚úÖ –ú–æ–¥—É–ª—ñ –∑ event-driven –ª–æ–≥—ñ–∫–æ—é
    AlarmModule alarm_module;                // –û–±—Ä–æ–±–∫–∞ –∞–≤–∞—Ä—ñ–π
    LoggingModule logging_module;            // –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π
    
    // ‚úÖ –ú–æ–¥—É–ª—ñ –∑ –Ω–µ—á–∞—Å—Ç–∏–º–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º–∏
    RTCModule rtc_module;                    // –ß–∞—Å —Ç–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä
    ConfigModule config_module;              // –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é
};

// Core 1 (Sensor Task) - –û–ø—Ç–∏–º–∞–ª—å–Ω—ñ –º–æ–¥—É–ª—ñ:
class CoreOneModules {
    // ‚úÖ –ú–æ–¥—É–ª—ñ –∑ real-time –≤–∏–º–æ–≥–∞–º–∏
    SensorModule sensor_module;             // –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö –¥–∞—Ç—á–∏–∫—ñ–≤
    
    // ‚úÖ –ú–æ–¥—É–ª—ñ –∑ —Ä–µ–≥—É–ª—è—Ä–Ω–∏–º–∏ I/O –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏
    DataLoggerModule data_logger;           // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
    
    // üö´ –£–ù–ò–ö–ê–¢–ò –Ω–∞ Core 1:
    // - –ú–æ–¥—É–ª—ñ –∑ networking (WiFi conflicts)
    // - –ú–æ–¥—É–ª—ñ –∑ –≤–µ–ª–∏–∫–∏–º –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º CPU
    // - –ú–æ–¥—É–ª—ñ –∑ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–º —á–∞—Å–æ–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
};
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —á–∞—Å–æ–≤–∏—Ö –±—é–¥–∂–µ—Ç—ñ–≤

```cpp
// –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ç–∞–π–º—ñ–Ω–≥—É –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å
class TimingConfiguration {
public:
    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (64 –¥–∞—Ç—á–∏–∫–∞, 16 –∞–∫—Ç—É–∞—Ç–æ—Ä—ñ–≤)
    static constexpr uint32_t STANDARD_CONFIG = {
        .main_loop_period_ms = 10,        // 100Hz
        .module_update_budget_ms = 8,     // 8ms –¥–ª—è –º–æ–¥—É–ª—ñ–≤
        .event_process_budget_ms = 2,     // 2ms –¥–ª—è –ø–æ–¥—ñ–π
        .sensor_task_period_ms = 100,     // 10Hz –¥–ª—è –¥–∞—Ç—á–∏–∫—ñ–≤
    };
    
    // –í–∏—Å–æ–∫–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (128 –¥–∞—Ç—á–∏–∫—ñ–≤, 32 –∞–∫—Ç—É–∞—Ç–æ—Ä–∏)
    static constexpr uint32_t HIGH_LOAD_CONFIG = {
        .main_loop_period_ms = 20,        // 50Hz (–±—ñ–ª—å—à–µ —á–∞—Å—É)
        .module_update_budget_ms = 15,    // 15ms –¥–ª—è –º–æ–¥—É–ª—ñ–≤
        .event_process_budget_ms = 4,     // 4ms –¥–ª—è –ø–æ–¥—ñ–π
        .sensor_task_period_ms = 50,      // 20Hz –¥–ª—è –¥–∞—Ç—á–∏–∫—ñ–≤
    };
    
    // –ù–∏–∑—å–∫–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (16 –¥–∞—Ç—á–∏–∫—ñ–≤, 8 –∞–∫—Ç—É–∞—Ç–æ—Ä—ñ–≤)
    static constexpr uint32_t LOW_LOAD_CONFIG = {
        .main_loop_period_ms = 5,         // 200Hz (–±—ñ–ª—å—à–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å)
        .module_update_budget_ms = 3,     // 3ms –¥–ª—è –º–æ–¥—É–ª—ñ–≤
        .event_process_budget_ms = 1,     // 1ms –¥–ª—è –ø–æ–¥—ñ–π
        .sensor_task_period_ms = 200,     // 5Hz –¥–ª—è –¥–∞—Ç—á–∏–∫—ñ–≤
    };
};
```

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø–∞–º'—è—Ç—ñ

```cpp
// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –ø–∞–º'—è—Ç—ñ
class MemoryOptimization {
public:
    static void configure_for_device_type() {
        // ESP32-S3 –∑ 8MB PSRAM
        if (esp_psram_is_initialized()) {
            configure_large_memory_setup();
        } else {
            configure_minimal_memory_setup();
        }
    }
    
private:
    static void configure_large_memory_setup() {
        // –ë—ñ–ª—å—à—ñ –±—É—Ñ–µ—Ä–∏ –¥–ª—è –∫—Ä–∞—â–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
        CONFIG_SHARED_STATE_MAX_ENTRIES = 128;
        CONFIG_EVENT_BUS_QUEUE_SIZE = 64;
        CONFIG_MODULE_MAX_COUNT = 32;
        
        ESP_LOGI(TAG, "Configured for large memory setup (8MB PSRAM)");
    }
    
    static void configure_minimal_memory_setup() {
        // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –±—É—Ñ–µ—Ä–∏ –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –ø–∞–º'—è—Ç—ñ
        CONFIG_SHARED_STATE_MAX_ENTRIES = 32;
        CONFIG_EVENT_BUS_QUEUE_SIZE = 16;
        CONFIG_MODULE_MAX_COUNT = 16;
        
        ESP_LOGI(TAG, "Configured for minimal memory setup (no PSRAM)");
    }
};
```

### Monitoring —Ç–∞ Alerting

```cpp
// –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
class PerformanceMonitor {
public:
    void update() {
        monitor_cycle_timing();
        monitor_memory_usage();
        monitor_task_performance();
        check_performance_alerts();
    }
    
private:
    void monitor_cycle_timing() {
        uint32_t avg_cycle_us = get_average_cycle_time();
        
        // –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–≤—ñ–ª—å–Ω—ñ —Ü–∏–∫–ª–∏
        if (avg_cycle_us > 8000) { // > 8ms
            ESP_LOGW(TAG, "Slow cycles detected: %lu Œºs average", avg_cycle_us);
            
            SharedState::increment("metrics.performance.slow_cycles", 1.0);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è
            if (avg_cycle_us > 12000) { // > 12ms
                suggest_performance_tuning();
            }
        }
    }
    
    void monitor_memory_usage() {
        size_t free_heap = Application::get_free_heap();
        size_t min_free_heap = Application::get_min_free_heap();
        
        // –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –Ω–∏–∑—å–∫—É –ø–∞–º'—è—Ç—å
        if (free_heap < 20480) { // < 20KB
            ESP_LOGW(TAG, "Low memory: %zu KB free, %zu KB minimum",
                     free_heap / 1024, min_free_heap / 1024);
            
            SharedState::increment("metrics.performance.low_memory_warnings", 1.0);
        }
        
        // –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –º–µ—Ç—Ä–∏–∫ –ø–∞–º'—è—Ç—ñ
        SharedState::set_typed("metrics.memory.free_heap_kb", (int)(free_heap / 1024));
        SharedState::set_typed("metrics.memory.min_free_heap_kb", (int)(min_free_heap / 1024));
    }
    
    void monitor_task_performance() {
        // –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ç–µ–∫—É
        size_t stack_remaining = Application::get_stack_high_water_mark();
        
        if (stack_remaining < 2048) { // < 2KB
            ESP_LOGW(TAG, "Low stack space: %zu bytes remaining", stack_remaining);
            
            Application::report_error("PerformanceMonitor", ESP_ERR_NO_MEM,
                                    Application::ErrorSeverity::ERROR,
                                    "Low stack space detected");
        }
    }
    
    void check_performance_alerts() {
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
        uint8_t cpu_usage = Application::get_cpu_usage();
        
        if (cpu_usage > 90) {
            ESP_LOGE(TAG, "Critical CPU usage: %u%%", cpu_usage);
            
            // –ê–≤–∞—Ä—ñ–π–Ω–∏–π —Ä–µ–∂–∏–º - –∑–º–µ–Ω—à–∏—Ç–∏ —á–∞—Å—Ç–æ—Ç—É –æ–Ω–æ–≤–ª–µ–Ω—å
            emergency_performance_mode();
        }
    }
    
    void suggest_performance_tuning() {
        ESP_LOGI(TAG, "Performance tuning suggestions:");
        ESP_LOGI(TAG, "  - Increase main loop period to 20ms");
        ESP_LOGI(TAG, "  - Reduce module update frequency");
        ESP_LOGI(TAG, "  - Check for blocking operations in modules");
        ESP_LOGI(TAG, "  - Consider disabling non-critical modules");
    }
    
    void emergency_performance_mode() {
        ESP_LOGW(TAG, "Entering emergency performance mode");
        
        // –ó–º–µ–Ω—à–∏—Ç–∏ —á–∞—Å—Ç–æ—Ç—É –æ–Ω–æ–≤–ª–µ–Ω—å
        SharedState::set("system.emergency_mode", true);
        
        // –í—ñ–¥–∫–ª—é—á–∏—Ç–∏ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ñ –º–æ–¥—É–ª—ñ
        ModuleManager::disable_non_critical_modules();
        
        // –ó–±—ñ–ª—å—à–∏—Ç–∏ –ø–µ—Ä—ñ–æ–¥ –≥–æ–ª–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É
        // (–ø–æ—Ç—Ä–µ–±—É—î –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É –¥–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è)
        SharedState::set("config.system.main_loop_period_ms", 20);
    }
    
    uint32_t get_average_cycle_time() {
        // –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ —á–∞—Å—É —Ü–∏–∫–ª—É
        return 5000; // –ó–∞–≥–ª—É—à–∫–∞
    }
};
```

## Troubleshooting —Ç–∞ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –¢–∏–ø–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è

**1. –ü–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è —á–∞—Å—É —Ü–∏–∫–ª—É (Cycle Overrun)**

```cpp
// –°–∏–º–ø—Ç–æ–º: "Cycle overrun: XXXXX us"
// –ü—Ä–∏—á–∏–Ω–∏ —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è:

void troubleshoot_cycle_overrun() {
    ESP_LOGI(TAG, "Troubleshooting cycle overrun...");
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 1: –ú–æ–¥—É–ª—ñ –∑ –¥–æ–≤–≥–∏–º —á–∞—Å–æ–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
    auto module_times = ModuleManager::get_execution_times();
    for (const auto& [module_name, time_us] : module_times) {
        if (time_us > 2000) { // > 2ms
            ESP_LOGW(TAG, "Slow module detected: %s (%lu Œºs)", 
                     module_name.c_str(), time_us);
        }
    }
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 2: –ë–ª–æ–∫—É—é—á—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
    check_for_blocking_operations();
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 3: –ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è —á–µ—Ä–≥–∏ –ø–æ–¥—ñ–π
    size_t event_queue_size = EventBus::get_queue_size();
    if (event_queue_size > 10) {
        ESP_LOGW(TAG, "Event queue overloaded: %zu events pending", 
                 event_queue_size);
    }
    
    // –†—ñ—à–µ–Ω–Ω—è: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
    if (get_overrun_frequency() > 5) { // > 5% —Ü–∏–∫–ª—ñ–≤
        ESP_LOGW(TAG, "Applying automatic performance tuning...");
        apply_automatic_tuning();
    }
}
```

**2. –ù–µ—Å—Ç–∞—á–∞ –ø–∞–º'—è—Ç—ñ (Memory Issues)**

```cpp
void troubleshoot_memory_issues() {
    size_t free_heap = Application::get_free_heap();
    size_t min_free_heap = Application::get_min_free_heap();
    
    ESP_LOGI(TAG, "Memory diagnostics:");
    ESP_LOGI(TAG, "  Current free: %zu KB", free_heap / 1024);
    ESP_LOGI(TAG, "  Minimum free: %zu KB", min_free_heap / 1024);
    ESP_LOGI(TAG, "  Stack remaining: %zu bytes", 
             Application::get_stack_high_water_mark());
    
    // –ê–Ω–∞–ª—ñ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
    auto sharedstate_stats = SharedState::get_stats();
    ESP_LOGI(TAG, "SharedState: %zu/%zu entries (%zu bytes each)",
             sharedstate_stats.used, sharedstate_stats.capacity,
             sizeof(SharedStateEntry));
    
    // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
    if (free_heap < 30720) { // < 30KB
        ESP_LOGW(TAG, "Memory optimization recommendations:");
        ESP_LOGW(TAG, "  - Reduce SharedState max entries");
        ESP_LOGW(TAG, "  - Disable debug logging");
        ESP_LOGW(TAG, "  - Consider PSRAM usage");
    }
}
```

**3. Multicore —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è**

```cpp
void troubleshoot_multicore_issues() {
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º—ñ–∂ —è–¥—Ä–∞–º–∏
    uint32_t core0_cycles = get_core0_cycle_count();
    uint32_t core1_cycles = get_core1_cycle_count();
    
    float core_balance = (float)core1_cycles / core0_cycles;
    
    ESP_LOGI(TAG, "Core balance: Core0: %lu, Core1: %lu (ratio: %.2f)",
             core0_cycles, core1_cycles, core_balance);
    
    if (core_balance < 0.1 || core_balance > 2.0) {
        ESP_LOGW(TAG, "Core load imbalance detected");
        suggest_core_rebalancing();
    }
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ –¥–æ—Å—Ç—É–ø—É –¥–æ SharedState
    check_sharedstate_contention();
}
```

## Best Practices –¥–ª—è –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó**

1. **–ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ return codes**
   ```cpp
   esp_err_t err = Application::init();
   if (err != ESP_OK) {
       // –û–±—Ä–æ–±–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É
   }
   ```

2. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ error reporting**
   ```cpp
   Application::report_error("MyModule", ESP_ERR_TIMEOUT,
                           Application::ErrorSeverity::ERROR,
                           "Operation timeout");
   ```

3. **–ú–æ–Ω—ñ—Ç–æ—Ä—ñ—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏**
   ```cpp
   if (Application::get_free_heap() < CRITICAL_HEAP_THRESHOLD) {
       // –ó–º–µ–Ω—à–∏—Ç–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
   }
   ```

4. **–ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Ç–∞–π–º—ñ–Ω–≥–∏ –ø—ñ–¥ –≤–∞—à–µ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è**
   ```cpp
   // –ë—ñ–ª—å—à–µ –¥–∞—Ç—á–∏–∫—ñ–≤ = –±—ñ–ª—å—à–∏–π –ø–µ—Ä—ñ–æ–¥ —Ü–∏–∫–ª—É
   #define MAIN_LOOP_PERIOD_MS (sensor_count > 64 ? 20 : 10)
   ```

### ‚ùå **–ß–æ–≥–æ —É–Ω–∏–∫–∞—Ç–∏**

1. **–ë–ª–æ–∫—É—é—á—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤ –º–æ–¥—É–ª—è—Ö**
   ```cpp
   // ‚ùå –ù–ï –†–û–ë–Ü–¢–¨ –¢–ê–ö
   void SlowModule::update() {
       vTaskDelay(pdMS_TO_TICKS(100)); // –ë–ª–æ–∫—É—î –Ω–∞ 100ms!
   }
   ```

2. **–î–∏–Ω–∞–º—ñ—á–Ω–∞ –∞–ª–æ–∫–∞—Ü—ñ—è –≤ —Ü–∏–∫–ª—ñ**
   ```cpp
   // ‚ùå –ù–ï –†–û–ë–Ü–¢–¨ –¢–ê–ö
   void BadModule::update() {
       char* buffer = malloc(1024); // –ö–æ–∂–Ω—ñ 10ms!
       // ...
       free(buffer);
   }
   ```

3. **–î–æ–≤–≥—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –±–µ–∑ —Ç–∞–π–º–∞—É—Ç—ñ–≤**
   ```cpp
   // ‚ùå –ù–ï –†–û–ë–Ü–¢–¨ –¢–ê–ö
   while (!operation_complete()) {
       // –ú–æ–∂–µ –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –Ω–∞–∑–∞–≤–∂–¥–∏
   }
   ```

## –í–∏—Å–Ω–æ–≤–æ–∫

Application –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–±–µ–∑–ø–µ—á—É—î –Ω–∞–¥—ñ–π–Ω—É —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—É –æ—Å–Ω–æ–≤—É –¥–ª—è –ø—Ä–æ–º–∏—Å–ª–æ–≤–∏—Ö —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏—Ö —Å–∏—Å—Ç–µ–º ModuChill. –ô–æ–≥–æ –±–∞–≥–∞—Ç–æ—è–¥–µ—Ä–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞, –¥–µ—Ç–∞–ª—å–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ robust error handling —Ä–æ–±–ª—è—Ç—å –π–æ–≥–æ —ñ–¥–µ–∞–ª—å–Ω–∏–º –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏—Ö –ø—Ä–æ–º–∏—Å–ª–æ–≤–∏—Ö –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω—å.

### **–ö–ª—é—á–æ–≤—ñ –ø–µ—Ä–µ–≤–∞–≥–∏**

- ‚úÖ **–î–µ—Ç–µ—Ä–º—ñ–Ω—ñ—Å—Ç–∏—á–Ω–∞ —Ä–æ–±–æ—Ç–∞** - —Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ —Ç–∞–π–º—ñ–Ω–≥–∏ –¥–ª—è real-time —Å–∏—Å—Ç–µ–º
- ‚úÖ **–ë–∞–≥–∞—Ç–æ—è–¥–µ—Ä–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è** - –µ—Ñ–µ–∫—Ç–∏–≤–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ESP32-S3
- ‚úÖ **–ü–æ–≤–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥** - –¥–µ—Ç–∞–ª—å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ **Robust error handling** - –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
- ‚úÖ **Graceful degradation** - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–≤–∂—É—î —Ä–æ–±–æ—Ç—É –ø—Ä–∏ —á–∞—Å—Ç–∫–æ–≤–æ–º—É –≤—ñ–¥–º–æ–≤—ñ
- ‚úÖ **–ü—Ä–æ–º–∏—Å–ª–æ–≤–∞ –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å** - –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –≤ real-world —É–º–æ–≤–∞—Ö

### **–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞**

Application –≥–æ—Ç–æ–≤–∏–π –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –ø—Ä–æ–º–∏—Å–ª–æ–≤–∏—Ö —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–∫–∞—Ö –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é:
- –°–∫–ª–∞–¥–Ω–∏—Ö multi-zone –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π
- Real-time –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
- Remote management —Ç–∞ OTA updates
- –ü–æ–≤–Ω–æ—ó —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ –ø—Ä–æ–º–∏—Å–ª–æ–≤–∏–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Ä–µ–∞–ª—å–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó: 2025-06-29*

