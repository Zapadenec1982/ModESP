# DS18B20 Async Driver

## Проблема з оригінальним драйвером

Оригінальний DS18B20 драйвер використовує блокуючий підхід для читання температури:

1. Надсилає команду конверсії температури
2. **Блокує виконання** за допомогою `vTaskDelay()` на час конверсії (до 750ms для 12-бітної роздільності)
3. Читає результат

Це призводить до 100% завантаження CPU, оскільки:
- При кількох сенсорах система блокується на кілька секунд
- Інші модулі не можуть виконуватись під час очікування
- Порушується реальний час системи

## Рішення - Асинхронний драйвер

Новий `DS18B20AsyncDriver` використовує state machine для неблокуючого читання:

### Стани:
1. **IDLE** - Готовий до нової конверсії
2. **CONVERSION_REQUESTED** - Команда відправлена
3. **WAITING_FOR_CONVERSION** - Очікування завершення (без блокування!)
4. **READY_TO_READ** - Готовий прочитати результат
5. **ERROR** - Помилка, потрібен reset

### Переваги:
- **Не блокує систему** - повертається негайно
- **Кешування даних** - повертає останнє валідне значення поки йде конверсія
- **Автоматичний retry** при помилках
- **Діагностика** - відстеження стану конверсії

### Використання:

У конфігурації змініть тип драйвера:

```json
{
  "sensors": [
    {
      "role": "temperature_1",
      "type": "DS18B20_Async",  // Замість "DS18B20"
      "publish_key": "sensors/temp1",
      "config": {
        "hal_id": "onewire_1",
        "address": "28FF123456789012",
        "resolution": 12,
        "max_retries": 3
      }
    }
  ]
}
```

### Налаштування SensorModule

Для оптимальної роботи з асинхронними драйверами, встановіть відповідний інтервал оновлення в ModuleManager:

```cpp
// Оновлювати сенсори кожні 100ms замість кожного циклу
module_manager.set_update_interval("SensorModule", 100);
```

Це дозволить:
- Драйверам завершити конверсію між викликами
- Зменшити навантаження на систему
- Отримувати свіжі дані без затримок
